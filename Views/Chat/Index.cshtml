@using MongoDbTutorial.Models.Users
@{
    var userInfo = ViewBag.Users as MongoDbTutorial.Models.Users.UserInfoDto;
    var userAll = ViewBag.AllUsers as List<UserResponse>;
    ViewBag.Title = "Chat";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="chat-app" data-user-id="@ViewBag.UserId" data-username="@ViewBag.Username">

    <div class="chat-users">
        <div class="users-header">
            <h5><i class="fas fa-users me-2"></i>Contacts</h5>
            <span class="badge bg-light text-dark" id="online-users"></span>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="userSearch" placeholder="Search contacts...">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <div class="users-list" id="usersList">
            @foreach (var user in userInfo.Followers)
            {
                <div class="user-item d-flex align-items-center" data-user-id="@user.Id">
                    <div class="user-avatar me-2">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info flex-grow-1">
                        <div class="user-name">@user.FullName</div>
                    </div>
                    <span class="badge bg-danger ms-2" id="unread-@user.Id" style="display:none;">0</span>
                </div>
            }
            @foreach (var user in userInfo.Following)
            {
                <div class="user-item d-flex align-items-center" data-user-id="@user.Id">
                    <div class="user-avatar me-2">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info flex-grow-1">
                        <div class="user-name">@user.FullName</div>
                    </div>
                    <span class="badge bg-danger ms-2" id="unread-@user.Id" style="display:none;">0</span>
                </div>
            }
        </div>
    </div>
    <div class="chat-window">
        <!-- Chat Header -->
        <div class="chat-header">
            <div class="chat-user-info">
                <div class="chat-user-avatar" id="chatUserAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div id="chatHeaderUsername">Select a contact</div>
                    <small class="text-muted" id="userStatus">Click on a contact to start chatting</small>
                </div>
            </div>
            <div class="chat-actions">
                <button title="Voice call" id="voiceCallBtn" disabled>
                    <i class="fas fa-phone"></i>
                </button>
                <button title="Video call" id="videoCallBtn" disabled>
                    <i class="fas fa-video"></i>
                </button>
                <button title="More options" id="moreOptionsBtn" disabled>
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>

        <!-- Messages Container -->
        <div class="messages-container" id="messagesContainer">
            <div class="welcome-message">
                <div class="welcome-icon">
                    <i class="fas fa-comments fa-4x text-muted mb-3"></i>
                </div>
                <h4 class="text-muted">Welcome to ChatApp</h4>
                <p class="text-muted">Select a contact from the list to start messaging</p>
            </div>
        </div>

        <!-- Auto-scroll indicator -->
        <div class="auto-scroll-indicator" id="autoScrollIndicator" title="Scroll to bottom">
            <i class="fas fa-arrow-down"></i>
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <span id="typingUser">Someone</span> is typing...
        </div>

        <!-- Chat Input -->
        <div class="chat-input-container">
            <div class="input-actions">
                <button class="btn btn-sm btn-outline-secondary" title="Emoji" id="emojiBtn">
                    <i class="fas fa-smile"></i>
                </button>
            </div>
            <div id="emojiPicker" class="emoji-picker" style="display:none;"></div>
            <textarea class="message-input" id="messageInput" placeholder="Type a message..." rows="1" disabled></textarea>
            <div class="send-buttons">
                <button class="send-btn" title="Send one-time message" id="sendOneTimeBtn" disabled>
                    <i class="fas fa-stopwatch"></i>
                </button>
                <button class="send-btn" title="Send message" id="sendBtn" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const emojiBtn = document.getElementById('emojiBtn');
        const emojiPicker = document.getElementById('emojiPicker');
        const messageInput = document.getElementById('messageInput');

               const emojis = [
            // Smileys & People
            "😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚",
            "😋","😛","😝","😜","🤪","😎","🤓","🧐","😕","😟","🙁","☹️","😮","😯","😲","😳","🥺","😦","😧","😨",
            "😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😤","😡","😠","🤬","🤯","😳","🥵","🥶","😶",
            "😐","😑","😬","🙄","😯","😦","😧","😮","😲","🥱","😴","🤤","😪","😵","🤐","🥴","🤢","🤮","🤧","😷",
            "🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","☠️","👽","👾","🤖","🎃",

            // Hands & Gestures
            "👋","🤚","🖐","✋","🖖","👌","🤌","🤏","✌️","🤞","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️",
            "👍","👎","✊","👊","🤛","🤜","🤚","🙌","👐","🤲","🤝","🙏",

            // Hearts & Love
            "❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","❣️","💕","💞","💓","💗","💖","💘","💝","💌",

            // Animals & Nature
            "🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐽","🐸","🐵","🦍","🦧","🐔",
            "🐧","🐦","🐤","🐣","🐥","🦆","🦢","🦉","🦚","🦜","🦇","🐺","🐗","🐴","🦄","🐝","🐛","🦋","🐌","🐞",
            "🐜","🦗","🕷","🕸","🦂","🐢","🐍","🦎","🐙","🦑","🦀","🦞","🐡","🐠","🐟","🐬","🐳","🐋","🐊","🐅",
            "🐆","🦓","🦍","🦧","🦣","🦛","🦏",

            // Food & Drink
            "🍏","🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🍈","🍒","🍑","🥭","🍍","🥥","🥝","🍅","🍆","🥑",
            "🥦","🥬","🥒","🌶","🫑","🌽","🥕","🥔","🍠","🥐","🥖","🥨","🥯","🥞","🧇","🧀","🍖","🍗","🥩",
            "🥓","🍔","🍟","🌭","🍕","🫓","🥪","🥙","🥗","🍿","🧈","🥫","🍱","🍣","🍛","🍜","🍲","🥘","🥣",
            "🥤","☕","🍵","🍶","🍺","🍻","🥂","🍷","🥃","🍸","🍹","🧋","🧃",

            // Travel & Places
            "🚗","🚕","🚙","🚌","🚎","🏎","🚓","🚑","🚒","🚐","🛻","🚚","🚛","🚜","🏍","🛵","🛺","🚲","🛴",
            "🛹","🛶","⛵","🚤","🛳","⛴","🚢","✈️","🛩","🛫","🛬","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🏠",
            "🏡","🏘","🏚","🏢","🏬","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏭","🏯","🏰","🏗","🏛","⛪","🕌","🕍","🕋",

            // Symbols & Misc
            "⭐","🌟","✨","⚡","☀️","🌤","⛅","☁️","🌧","⛈","🌩","🌨","❄️","☃️","🌬","💨","🌪","🌈","🌊",
            "🔥","💧","🌱","🌿","☘️","🍀","🎄","🎃","🎆","🎇","🧨","🎈","🎉","🎊","🎁","🎗","🏆","🏅","🎖",
            "🏵","🎫","🎟","🎭","🎨","🎬","🎤","🎧","🎼","🎹","🥁","🎷","🎺","🎸","🪕","🎻","🏹","🎯","🎲",
            "♠️","♥️","♦️","♣️","🃏","🎴","🀄"
        ];

        emojis.forEach(e => {
            const span = document.createElement('span');
            span.textContent = e;
            span.addEventListener('click', () => {
                messageInput.value += e;
                messageInput.focus();
            });
            emojiPicker.appendChild(span);
        });

        // Toggle emoji picker on button click
        emojiBtn.addEventListener('click', () => {
            emojiPicker.style.display = emojiPicker.style.display === 'none' ? 'flex' : 'none';
        });
    </script>
    <script src="~/js/index.js"></script>
}